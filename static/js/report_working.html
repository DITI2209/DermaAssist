<!DOCTYPE html>
<html>
  <head>
    <meta charset = "UTF-8">
    <title>Medical Document</title>
    <link rel = "stylesheet" href = "/static/css/style.css">
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.min.js"></script>
  </head>
  <body>
    <h1>Medical Document Template</h1>
    <div id = "medicalDocument">
      <h2>Patient Information</h2>
      <p>Patient Name: <span id = "patientName">{{patient_name}}</span></p>
      <p>Patient Email: <span id = "pemail">{{patient_email}}</span></p>
      <p>Address: <span id = "address"></span></p>
      <p>Phone: <span id = "phone" >{{patient_phone}}</span></p>

      <h2>Medical Information</h2>
      <p>Diagnosed with: <span id = "chiefComplaint" >{{result}}</span></p>
      <p>History of Present Illness: <span id = "history" contenteditable = "true"></span></p>
      <p>Review of Systems: <span id = "ros" contenteditable = "true"></span></p>
      <p>Physical Exam: <span id = "physicalExam" contenteditable = "true"></span></p>
      <p>Assessment and Plan: <span id = "assessment" contenteditable = "true"></span></p>
    </div>
    <button id = "pdf">Print to PDF</button>
    <form action = "/report" method = "post">
    <button id = 'printBtn' type = "submit">Generate PDF</button>
    </form>
    <script src = "https://www.gstatic.com/firebasejs/8.4.2/firebase-app.js"></script>
    <script src = "https://www.gstatic.com/firebasejs/8.4.2/firebase-auth.js"></script>
    <script src = "https://www.gstatic.com/firebasejs/8.4.2/firebase-storage.js"></script>
    <script>
      var firebaseConfig = {
      "apiKey": "AIzaSyAR0XBuGC2yywq-q1DfQKfLl26LKk6l9K8",
      "authDomain": "fir-try-28f01.firebaseapp.com",
      "databaseURL": "https://fir-try-28f01-default-rtdb.firebaseio.com",
      "projectId": "fir-try-28f01",
      "storageBucket": "fir-try-28f01.appspot.com",
      "messagingSenderId": "588321601903",
      "appId": "1:588321601903:web:e072797fc9189e9465d09a",
      "measurementId": "G-04938M5W17"
      };
      firebase.initializeApp(firebaseConfig);
      document.getElementById('pdf').addEventListener('click', function() {
        console.log('Generate PDF button clicked');
        var backgroundColor = '#FFFFFF'; // Set the desired background color
        var originalBackgroundColor = document.body.style.backgroundColor; // Store the original background color
  // Set the background color of the page to the desired color
  document.body.style.backgroundColor = backgroundColor;
        window.print(); // Generate a PDF of the current webpage
        setTimeout(function() {
          console.log('Generating PDF');
          var pdf = new jsPDF();
          document.getElementById('pdf').style.display = 'none';
          pdf.addHTML(document.body, function() {
            var blob = pdf.output('blob'); // Convert the PDF to a Blob
            var storageRef = firebase.storage().ref();
            var uploadTask = storageRef.child('reports/newwebpage.pdf').put(blob); // Upload the PDF to Firebase Storage
            uploadTask.on('state_changed', function(snapshot) {
              // Handle progress events
            }, function(error) {
              // Handle errors
            }, function() {
              // Handle successful upload
              console.log('PDF file uploaded to Firebase Storage');
            });
          });
          document.getElementById("myForm").submit();
        }, 500); // Wait 500 milliseconds to allow the PDF to be generated
      });
    </script>
  </body>
</html>